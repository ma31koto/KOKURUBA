<%= search_form_for @q do |f| %>
  <%= f.label :title, "タイトル" %>
  <%= f.search_field :title_cont %>

  <%= f.label :area_id, "エリア" %>
  <%= f.collection_select :area_id_eq, Area.all, :id, :name, include_blank: "----", class: "form-control" %>

  <%= f.label :tag, "タグ名" %>
  <%= f.search_field :post_tags_tag_name_cont %>

  <%= f.submit "検索" %>
<% end %>


<table>
  <thead>
    <tr>
      <th></th>
      <th>エリア</th>
      <th>関連タグ</th>
      <th>総合評価</th>
      <th>雰囲気</th>
      <th>人の少なさ</th>
      <th>定番度</th>
      <th>告白成功率</th>
      <th>コメント数</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% posts.each do |post| %>
    <tr>
      <td>
        <%= link_to post_path(post) do %>
          <%= image_tag post.get_spot_image, size: "50x50" %></br>
          <%= post.title %>
        <% end %>
      </td>
      <td><%= post.area.name %></td>
      <td>
        <% post.tags.each do |tag| %>
          <%= tag.name %></br>
        <% end %>
      </td>
      <td>
        <%= post.all_rate.round(1).to_f %>
        <div class="star" data-score="<%= post.all_rate %>"></div>
      </td>
      <td>
        <%= post.atmosphere_rate.round(1).to_f %>
        <div class="star" data-score="<%= post.atmosphere_rate %>"></div>
      </td>
      <td>
        <%= post.few_people_rate.round(1).to_f %>
        <div class="star" data-score="<%= post.few_people_rate %>"></div>
      </td>
      <td>
        <%= post.standard_rate.round(1).to_f %>
        <div class="star" data-score="<%= post.standard_rate %>"></div>
      </td>
      <td>
        <% unless post.avg_confession_result %>
          未回答
        <% else %>
          <%= post.avg_confession_result %>％
        <% end %>
      </td>
      <td><%= post.post_comments.count %>件</td>
      <td><%= link_to "表示する", post_path(post), class: "btn btn-success" %></td>
    </tr>
    <% end %>
  </tbody>
</table>

<script>
  $(document).on('turbolinks:load', function() {
    $('.star').empty();
    $('.star').raty({
      size: 20,
      starOff:  '<%= asset_path('star-off.png') %>',
      starOn : '<%= asset_path('star-on.png') %>',
      starHalf: '<%= asset_path('star-half.png') %>',
      half: true,
      readOnly: true,
    });
  });
</script>