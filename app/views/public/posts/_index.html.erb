<div class="d-flex flex-wrap">
  並び替え
  <div class"ranking-tab"><%= sort_link(@q, :created_at, "新着", default_order: :desc)%></div>
  <div class"ranking-tab"><a href="javascript:onSortAllRateRanking()">総合評価<span id="all_rate_asc" style="display:none">▼</span><span id="all_rate_desc" style="display:none">▲</span></a></div>
  <div class"ranking-tab"><a href="javascript:onSortAtmosphereRateRanking()">雰囲気<span id="atmosphere_rate_asc" style="display:none">▼</span><span id="atmosphere_rate_desc" style="display:none">▲</span></a></div>
  <div class"ranking-tab"><a href="javascript:onSortFewPeopleRateRanking()">人の少なさ<span id="few_people_rate_asc" style="display:none">▼</span><span id="few_people_rate_desc" style="display:none">▲</span></a></div>
  <div class"ranking-tab"><a href="javascript:onSortStandardRateRanking()">定番度<span id="standard_rate_asc" style="display:none">▼</span><span id="standard_rate_desc" style="display:none">▲</span></a></div>
  <div class"ranking-tab"><a href="javascript:onSortConfessionRranking()">告白成功率<span id="confession_asc" style="display:none">▼</span><span id="confession_desc" style="display:none">▲</span></a></div>
</div>

<div class="mx-auto mt-5">
  <table class="table-bordered">
     <thead>
      <tr style="height: 50px; background-color: #666633;" class="text-center align-middle">
        <th width="10%"></th>
        <th width="10%">エリア</th>
        <th width="10%">関連タグ</th>
        <th width="10%">総合評価</th>
        <th width="10%">雰囲気</th>
        <th width="10%">人の少なさ</th>
        <th width="10%">定番度</th>
        <th width="8%">告白<br/>成功率</th>
        <th width="8%">コメント数</th>
      </tr>
    </thead>
    <tbody>
      <% posts.each do |post| %>
      <tr>
        <td>
          <div class="ml-3 align-middle">
            <%= link_to post_path(post) do %>
              <%= image_tag post.get_spot_image, size: "150x100" %></br>
              <%= post.title %>
            <% end %>
          </div>
        </td>
        <td>
          <div class="ml-3 h6">
            <%= post.area.name %>
          </div>
        </td>
        <td>
          <div class="ml-3 h6">
            <% post.tags.each do |tag| %>
              <%= tag.name %></br>
            <% end %>
          </div>
        </td>
        <td>
          <div class="ml-3">
            <%= post.avg_all_rate.round(1).to_f %>
            <div class="star" data-score="<%= post.avg_all_rate %>"></div>
          </div>
        </td>
        <td>
          <div class="ml-3">
            <%= post.avg_atmosphere_rate.round(1).to_f %>
            <div class="star" data-score="<%= post.avg_atmosphere_rate %>"></div>
          </div>
        </td>
        <td>
          <div class="ml-3">
            <%= post.avg_few_people_rate.round(1).to_f %>
            <div class="star" data-score="<%= post.avg_few_people_rate %>"></div>
          </div>
        </td>
        <td>
          <div class="ml-3">
            <%= post.avg_standard_rate.round(1).to_f %>
            <div class="star" data-score="<%= post.avg_standard_rate %>"></div>
          </div>
        </td>
        <td>
          <div class="ml-3">
            <% unless post.avg_confession_result %>
              未回答
            <% else %>
              <%= post.avg_confession_result %>％
            <% end %>
          </div>
        </td>
        <td>
          <div class="ml-3">
            <%= post.post_comments.count %>件
          </div>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>
</div>



<script>
  $(document).on('turbolinks:load', function() {
    $('.star').empty();
    $('.star').raty({
      size: 36,
      starOff:  '<%= asset_path('star-off.png') %>',
      starOn : '<%= asset_path('star-on.png') %>',
      starHalf: '<%= asset_path('star-half.png') %>',
      half: true,
      readOnly: true,
    });

    $('#confession_desc').hide();
    $('#confession_asc').hide();
    <% if params[:confession_ranking] =='asc' %>
      $('#confession_asc').show();
    <% elsif params[:confession_ranking] == 'desc' %>
      $('#confession_desc').show();
    <% end %>
    $('.sort_link').each( function(i,elem){
      var str = $(elem).attr('href').replace('confession_ranking=','');
      $(elem).attr('href',str);
      console.log($(elem).attr('href'))
    })

    $('#all_rate_desc').hide();
    $('#all_rate_asc').hide();
    <% if params[:all_rate_ranking] =='asc' %>
      $('#all_rate_asc').show();
    <% elsif params[:all_rate_ranking] == 'desc' %>
      $('#all_rate_desc').show();
    <% end %>
    $('.sort_link').each( function(i,elem){
      var str = $(elem).attr('href').replace('all_rate_ranking=','');
      $(elem).attr('href',str);
      console.log($(elem).attr('href'))
    })

    $('#atmosphere_rate_desc').hide();
    $('#atmosphere_rate_asc').hide();
    <% if params[:atmosphere_rate_ranking] =='asc' %>
      $('#atmosphere_rate_asc').show();
    <% elsif params[:atmosphere_rate_ranking] == 'desc' %>
      $('#atmosphere_rate_desc').show();
    <% end %>
    $('.sort_link').each( function(i,elem){
      var str = $(elem).attr('href').replace('atmosphere_rate_ranking=','');
      $(elem).attr('href',str);
      console.log($(elem).attr('href'))
    })

    $('#few_people_rate_desc').hide();
    $('#few_people_rate_asc').hide();
    <% if params[:few_people_rate_ranking] =='asc' %>
      $('#few_people_rate_asc').show();
    <% elsif params[:few_people_rate_ranking] == 'desc' %>
      $('#few_people_rate_desc').show();
    <% end %>
    $('.sort_link').each( function(i,elem){
      var str = $(elem).attr('href').replace('few_people_rate_ranking=','');
      $(elem).attr('href',str);
      console.log($(elem).attr('href'))
    })

    $('#standard_rate_desc').hide();
    $('#standard_rate_asc').hide();
    <% if params[:standard_rate_ranking] =='asc' %>
      $('#standard_rate_asc').show();
    <% elsif params[:standard_rate_ranking] == 'desc' %>
      $('#standard_rate_desc').show();
    <% end %>
    $('.sort_link').each( function(i,elem){
      var str = $(elem).attr('href').replace('standard_rate_ranking=','');
      $(elem).attr('href',str);
      console.log($(elem).attr('href'))
    })

  });


  function onSortConfessionRranking(){
    var form = document.getElementById('post_search');
  <% if params[:confession_ranking] == 'asc' %>
    document.getElementById('confession_ranking').value='desc';
  <% else %>
    document.getElementById('confession_ranking').value='asc';
  <% end %>
    form.submit();
  }

  function onSortAllRateRanking(){
    var form = document.getElementById('post_search');
  <% if params[:all_rate_ranking] == 'asc' %>
    document.getElementById('all_rate_ranking').value='desc';
  <% else %>
    document.getElementById('all_rate_ranking').value='asc';
  <% end %>
    form.submit();
  }

  function onSortAtmosphereRateRanking(){
    var form = document.getElementById('post_search');
  <% if params[:atmosphere_rate_ranking] == 'asc' %>
    document.getElementById('atmosphere_rate_ranking').value='desc';
  <% else %>
    document.getElementById('atmosphere_rate_ranking').value='asc';
  <% end %>
    form.submit();
  }

  function onSortFewPeopleRateRanking(){
    var form = document.getElementById('post_search');
  <% if params[:few_people_rate_ranking] == 'asc' %>
    document.getElementById('few_people_rate_ranking').value='desc';
  <% else %>
    document.getElementById('few_people_rate_ranking').value='asc';
  <% end %>
    form.submit();
  }

  function onSortStandardRateRanking(){
    var form = document.getElementById('post_search');
  <% if params[:standard_rate_ranking] == 'asc' %>
    document.getElementById('standard_rate_ranking').value='desc';
  <% else %>
    document.getElementById('standard_rate_ranking').value='asc';
  <% end %>
    form.submit();
  }

</script>